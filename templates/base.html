<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç-–ú–∞–≥–∞–∑–∏–Ω{% endblock %}</title>
    {% block head %}{% endblock %}
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Comic+Neue:wght@300;400;700&display=swap');
        body { 
            font-family: 'Fredoka', 'Comic Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .transition-all { transition: all 0.3s ease; }
        .sidebar-hidden { transform: translateX(-100%); }
        .sidebar-overlay { display: none; }
        .sidebar-overlay.active { display: block; }
        @media (min-width: 1024px) {
            .sidebar-overlay { display: none !important; }
        }
        .bounce-hover:hover {
            animation: bounce 0.6s ease infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .wiggle:hover {
            animation: wiggle 0.5s ease-in-out infinite;
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 min-h-screen">
    <!-- –®–∞–ø–∫–∞ -->
    <header class="bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 shadow-lg border-b-2 sm:border-b-4 border-yellow-400 fixed top-0 left-0 right-0 z-40 h-16 sm:h-[4.5rem] md:h-20">
        <div class="flex items-center justify-between h-full px-2 sm:px-3 md:px-4">
            <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
            <button id="sidebar-toggle" class="lg:hidden p-2 rounded-lg text-white hover:text-yellow-200 hover:bg-white/20 transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            
            <!-- –õ–æ–≥–æ—Ç–∏–ø -->
            <a href="{{ url_for('main.index') }}" class="text-base sm:text-xl md:text-2xl font-bold text-white hover:text-yellow-200 transition-all bounce-hover flex items-center gap-1 sm:gap-2 flex-1 sm:flex-initial">
                <span class="text-xl sm:text-2xl md:text-3xl">üéà</span>
                <span class="hidden sm:inline">–ú–∞–≥–∞–∑–∏–Ω —ñ–≥—Ä–∞—à–æ–∫</span>
                <span class="sm:hidden">–ú–∞–≥–∞–∑–∏–Ω</span>
                <span class="text-xl sm:text-2xl md:text-3xl">üéÅ</span>
            </a>
            
            <!-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ç–∞ –∫–æ—à–∏–∫ -->
            <div class="flex items-center space-x-1 sm:space-x-2 md:space-x-3">
                {% if current_user.is_authenticated %}
                    <!-- –ö–æ—à–∏–∫ -->
                    <a href="{{ url_for('main.cart') }}" class="relative p-1.5 sm:p-2 text-white hover:text-yellow-200 hover:bg-white/20 rounded-xl transition-all group bounce-hover">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 md:w-7 md:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        {% if cart_count > 0 %}
                            <span class="absolute -top-0.5 -right-0.5 sm:-top-1 sm:-right-1 bg-gradient-to-r from-red-500 via-pink-500 to-yellow-400 text-white text-xs font-bold rounded-full h-5 w-5 sm:h-6 sm:w-6 flex items-center justify-center shadow-lg border-2 border-white text-[10px] sm:text-xs">
                                {{ cart_count }}
                            </span>
                        {% endif %}
                    </a>
                    
                    <span class="hidden md:inline text-white text-sm font-medium">–ü—Ä–∏–≤—ñ—Ç, {{ current_user.username }}! üëã</span>
                    <a href="{{ url_for('auth.logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1.5 sm:px-3 sm:py-2 md:px-4 md:py-2 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-all shadow-lg hover:shadow-xl">
                        <span class="hidden sm:inline">–í–∏–π—Ç–∏</span>
                        <span class="sm:hidden">‚úï</span>
                    </a>
                {% else %}
                    <a href="{{ url_for('auth.login') }}" class="text-white hover:text-yellow-200 px-2 py-1.5 sm:px-3 sm:py-2 md:px-4 md:py-2 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-all hover:bg-white/20">
                        <span class="hidden sm:inline">–£–≤—ñ–π—Ç–∏</span>
                        <span class="sm:hidden">‚Üí</span>
                    </a>
                    <a href="{{ url_for('auth.register') }}" class="bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-500 hover:from-yellow-300 hover:via-pink-400 hover:to-purple-400 text-white px-2 py-1.5 sm:px-3 sm:py-2 md:px-4 md:py-2 rounded-lg sm:rounded-xl text-xs sm:text-sm font-bold shadow-lg hover:shadow-xl transition-all bounce-hover">
                        <span class="hidden md:inline">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è üéâ</span>
                        <span class="md:hidden">üéâ</span>
                    </a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Overlay –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö -->
    <div id="sidebar-overlay" class="sidebar-overlay fixed inset-0 bg-black bg-opacity-60 z-30 lg:hidden"></div>

    <!-- –ë–æ–∫–æ–≤–µ –º–µ–Ω—é -->
    <aside id="sidebar" class="fixed top-16 sm:top-[4.5rem] md:top-20 left-0 h-[calc(100vh-4rem)] sm:h-[calc(100vh-4.5rem)] md:h-[calc(100vh-5rem)] w-56 sm:w-64 bg-gradient-to-b from-pink-200 via-purple-200 to-indigo-200 shadow-2xl border-r-2 sm:border-r-4 border-yellow-400 z-30 transition-transform duration-300 ease-in-out sidebar-hidden lg:translate-x-0">
        <nav class="h-full overflow-y-auto py-6">
            <div class="px-4 space-y-1">
                <!-- –ì–æ–ª–æ–≤–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è -->
                <a href="{{ url_for('main.index') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                    <span class="text-2xl mr-3">üè†</span>
                    <span class="font-bold text-lg">–ö–∞—Ç–∞–ª–æ–≥</span>
                </a>
                
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('main.cart') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                        <span class="text-2xl mr-3">üõí</span>
                        <span class="font-bold text-lg">–ö–æ—à–∏–∫</span>
                    </a>
                    
                    <a href="{{ url_for('main.orders') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                        <span class="text-2xl mr-3">üì¶</span>
                        <span class="font-bold text-lg">–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
                    </a>
                    
                    <a href="{{ url_for('auth.profile') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                        <span class="text-2xl mr-3">üë§</span>
                        <span class="font-bold text-lg">–ü—Ä–æ—Ñ—ñ–ª—å</span>
                    </a>
                {% endif %}
                
                {% if current_user.is_authenticated and current_user.is_admin %}
                    <div class="pt-4 mt-4 border-t-4 border-yellow-400">
                        <p class="px-4 text-sm font-bold text-purple-900 uppercase tracking-wider mb-3">üéØ –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</p>
                        
                        <a href="{{ url_for('admin.dashboard') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üìä</span>
                            <span class="font-bold text-lg">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</span>
                        </a>
                        
                        <a href="{{ url_for('admin.products') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üéÅ</span>
                            <span class="font-bold text-lg">–¢–æ–≤–∞—Ä–∏</span>
                        </a>
                        
                        <a href="{{ url_for('admin.categories') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üè∑Ô∏è</span>
                            <span class="font-bold text-lg">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</span>
                        </a>
                        
                        <a href="{{ url_for('admin.orders') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üìã</span>
                            <span class="font-bold text-lg">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
                        </a>
                        
                        <a href="{{ url_for('admin.users') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üë•</span>
                            <span class="font-bold text-lg">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</span>
                        </a>
                        
                        <a href="{{ url_for('admin.telegram_settings') }}" class="flex items-center px-4 py-3 text-purple-800 rounded-xl hover:bg-gradient-to-r hover:from-pink-300 hover:to-purple-300 hover:text-white transition-all group bounce-hover shadow-md hover:shadow-lg">
                            <span class="text-2xl mr-3">üì±</span>
                            <span class="font-bold text-lg">Telegram</span>
                        </a>
                    </div>
                {% endif %}
            </div>
        </nav>
    </aside>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é -->
    <div class="flex pt-16 sm:pt-[4.5rem] md:pt-20">
        <!-- –ü—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø—ñ -->
        <div class="hidden lg:block w-64 flex-shrink-0"></div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="flex-1 min-w-0">
            <!-- Toast –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
            <div id="toast-container" class="fixed top-20 sm:top-24 md:top-28 right-4 sm:right-6 md:right-8 z-50 space-y-2 sm:space-y-3 max-w-sm w-full"></div>
            
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="max-w-7xl mx-auto px-2 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 md:py-8">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>


    <!-- JavaScript –¥–ª—è –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é -->
    <script>
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        function toggleSidebar() {
            sidebar.classList.toggle('sidebar-hidden');
            sidebarOverlay.classList.toggle('active');
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
        }

        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', toggleSidebar);
        }

        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö
        if (window.innerWidth < 1024) {
            const sidebarLinks = sidebar.querySelectorAll('a');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    sidebar.classList.add('sidebar-hidden');
                    sidebarOverlay.classList.remove('active');
                });
            });
        }

        // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('sidebar-hidden');
                if (sidebarOverlay) sidebarOverlay.classList.remove('active');
            } else {
                if (!sidebar.classList.contains('sidebar-hidden')) {
                    sidebar.classList.add('sidebar-hidden');
                }
                if (sidebarOverlay) sidebarOverlay.classList.remove('active');
            }
        });
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        if (window.innerWidth >= 1024) {
            sidebar.classList.remove('sidebar-hidden');
        }
        
        // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –¥–ª—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        const animatedElements = document.querySelectorAll('.bounce-hover');
        animatedElements.forEach(el => {
            el.addEventListener('mouseenter', () => {
                el.style.animation = 'bounce 0.6s ease infinite';
            });
            el.addEventListener('mouseleave', () => {
                el.style.animation = '';
            });
        });
        
        // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
        function showConfirmModal(message, callback) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 transform transition-all">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                            <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h3>
                        <p class="text-sm text-gray-600 mb-6">${message}</p>
                        <div class="flex gap-3 justify-center">
                            <button id="confirm-cancel" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors">
                                –°–∫–∞—Å—É–≤–∞—Ç–∏
                            </button>
                            <button id="confirm-ok" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                                –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const cancelBtn = modal.querySelector('#confirm-cancel');
            const okBtn = modal.querySelector('#confirm-ok');
            
            cancelBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            okBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
                if (callback) callback();
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        // –ó–∞–º—ñ–Ω—é—î–º–æ –≤—Å—ñ confirm() –Ω–∞ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞
        document.addEventListener('click', (e) => {
            const deleteBtn = e.target.closest('button[onclick*="confirm"]');
            if (deleteBtn && deleteBtn.onclick) {
                const onclickStr = deleteBtn.getAttribute('onclick');
                if (onclickStr && onclickStr.includes('confirm')) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ onclick
                    const messageMatch = onclickStr.match(/confirm\(['"]([^'"]+)['"]\)/);
                    const message = messageMatch ? messageMatch[1] : '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ?';
                    
                    // –û—Ç—Ä–∏–º—É—î–º–æ —Ñ–æ—Ä–º—É
                    const form = deleteBtn.closest('form');
                    
                    showConfirmModal(message, () => {
                        if (form) {
                            form.submit();
                        }
                    });
                }
            }
        });
        
        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞ –º—ñ–∂ —Å–µ—Å—ñ—è–º–∏
        const CartManager = {
            // –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ—à–∏–∫ –≤ localStorage
            saveCart: function(cartItems) {
                try {
                    const cartData = cartItems.map(item => ({
                        product_id: item.product_id || item.id,
                        quantity: item.quantity || 1
                    }));
                    localStorage.setItem('cart', JSON.stringify(cartData));
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', e);
                }
            },
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ—à–∏–∫ –∑ localStorage
            loadCart: function() {
                try {
                    const cartData = localStorage.getItem('cart');
                    return cartData ? JSON.parse(cartData) : [];
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', e);
                    return [];
                }
            },
            
            // –û—á–∏—Å—Ç–∏—Ç–∏ –∫–æ—à–∏–∫ –≤ localStorage
            clearCart: function() {
                try {
                    localStorage.removeItem('cart');
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', e);
                }
            },
            
            // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∫–æ—à–∏–∫ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º (–ø—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó)
            syncCart: function() {
                const cartItems = this.loadCart();
                if (cartItems.length === 0) {
                    return;
                }
                
                fetch('{{ url_for("main.sync_cart") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cart: cartItems })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û—á–∏—â–∞—î–º–æ localStorage –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
                        this.clearCart();
                        // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ–≥–æ –∫–æ—à–∏–∫–∞
                        if (window.location.pathname.includes('/cart')) {
                            window.location.reload();
                        }
                    }
                })
                .catch(error => {
                    console.error('–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ—à–∏–∫–∞:', error);
                });
            }
        };
        
        // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ—à–∏–∫–∞ –ø—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        {% if current_user.is_authenticated %}
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –∫–æ—à–∏–∫ —ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –π–æ–≥–æ
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –Ω–µ –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É (–ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ URL)
            const urlParams = new URLSearchParams(window.location.search);
            const justDeleted = urlParams.get('deleted');
            
            // –Ø–∫—â–æ –Ω–µ –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –∫–æ—à–∏–∫
            if (!justDeleted) {
                const savedCart = CartManager.loadCart();
                if (savedCart.length > 0) {
                    CartManager.syncCart();
                } else {
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—à–∏–∫ –∑ —Å–µ—Ä–≤–µ—Ä–∞ –≤ localStorage
                    fetch('{{ url_for("main.get_cart") }}')
                        .then(response => response.json())
                        .then(data => {
                            if (data.cart && data.cart.length > 0) {
                                CartManager.saveCart(data.cart);
                            }
                        })
                        .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', error));
                }
            } else {
                // –Ø–∫—â–æ –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è, –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î–º–æ localStorage –∑ —Å–µ—Ä–≤–µ—Ä–∞
                fetch('{{ url_for("main.get_cart") }}')
                    .then(response => response.json())
                    .then(data => {
                        if (data.cart) {
                            CartManager.saveCart(data.cart);
                        }
                        // –í–∏–¥–∞–ª—è—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä deleted –∑ URL
                        const url = new URL(window.location);
                        url.searchParams.delete('deleted');
                        window.history.replaceState({}, '', url);
                    })
                    .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', error));
            }
        });
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ—à–∏–∫ –ø—ñ—Å–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ –∫–æ—à–∏–∫–æ–º (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –ù–ï –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è)
        document.addEventListener('submit', function(e) {
            const form = e.target;
            if (form && form.action && (form.action.includes('/cart/add/') || form.action.includes('/cart/update/'))) {
                // –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ submit –æ–Ω–æ–≤–ª—é—î–º–æ –∫–æ—à–∏–∫ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
                setTimeout(() => {
                    {% if current_user.is_authenticated %}
                    fetch('{{ url_for("main.get_cart") }}')
                        .then(response => response.json())
                        .then(data => {
                            if (data.cart) {
                                CartManager.saveCart(data.cart);
                            }
                        })
                        .catch(error => console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞:', error));
                    {% endif %}
                }, 1000);
            }
        });
        {% endif %}
        
        // Toast-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            const typeConfig = {
                'success': { bg: 'bg-green-500', icon: '‚úÖ', border: 'border-green-600' },
                'error': { bg: 'bg-red-500', icon: '‚ùå', border: 'border-red-600' },
                'warning': { bg: 'bg-yellow-500', icon: '‚ö†Ô∏è', border: 'border-yellow-600' },
                'info': { bg: 'bg-blue-500', icon: '‚ÑπÔ∏è', border: 'border-blue-600' }
            };
            
            const config = typeConfig[type] || typeConfig['info'];
            
            toast.className = `${config.bg} ${config.border} border-2 text-white px-4 py-3 rounded-xl shadow-2xl transform transition-all duration-300 ease-in-out translate-x-full opacity-0 flex items-center gap-3 min-w-[280px] max-w-sm`;
            toast.innerHTML = `
                <span class="text-xl flex-shrink-0">${config.icon}</span>
                <span class="flex-1 text-sm sm:text-base font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="text-white hover:text-gray-200 flex-shrink-0 text-lg font-bold">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 300);
            }, 5000);
        }
        
        // –ü–æ–∫–∞–∑—É—î–º–æ flash-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫ toast
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                document.addEventListener('DOMContentLoaded', function() {
                    {% for category, message in messages %}
                        showToast({{ message|tojson }}, {{ category|tojson }});
                    {% endfor %}
                });
            {% endif %}
        {% endwith %}
    </script>
</body>
</html>

