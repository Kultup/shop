{% extends "base.html" %}

{% block title %}–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è - –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç-–ú–∞–≥–∞–∑–∏–Ω{% endblock %}

{% block content %}
<div class="mb-4 sm:mb-6 px-2 sm:px-0">
    <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-purple-900 mb-4 sm:mb-6 text-center drop-shadow-lg flex items-center justify-center gap-2">
        <span class="text-3xl sm:text-4xl">üì¶</span>
        <span>–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
        <span class="text-3xl sm:text-4xl">üìã</span>
    </h1>
</div>

{% if orders %}
    <div class="space-y-4 sm:space-y-6 px-2 sm:px-0">
        {% for order in orders %}
            <div class="bg-gradient-to-br from-white via-pink-50 via-purple-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-xl border-2 sm:border-4 border-yellow-300 p-4 sm:p-5 md:p-6 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-5 pb-4 sm:pb-5 border-b-2 border-purple-200">
                    <div class="flex-1">
                        <h2 class="text-lg sm:text-xl md:text-2xl font-bold text-purple-900 mb-2 flex items-center gap-2">
                            <span class="text-2xl sm:text-3xl">üì¶</span>
                            <span>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #{{ order.id }}</span>
                        </h2>
                        <p class="text-xs sm:text-sm text-purple-600 font-medium flex items-center gap-1">
                            <span>üìÖ</span>
                            <span>–î–∞—Ç–∞: {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </p>
                        {% if order.city or order.institution %}
                            <div class="mt-2 space-y-1">
                                {% if order.city %}
                                    <p class="text-xs sm:text-sm text-purple-700 font-medium flex items-center gap-1">
                                        <span>üèôÔ∏è</span>
                                        <span><span class="font-bold">–ú—ñ—Å—Ç–æ:</span> {{ order.city }}</span>
                                    </p>
                                {% endif %}
                                {% if order.institution %}
                                    <p class="text-xs sm:text-sm text-purple-700 font-medium flex items-center gap-1">
                                        <span>üè´</span>
                                        <span><span class="font-bold">–ó–∞–∫–ª–∞–¥:</span> {{ order.institution }}</span>
                                    </p>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                    <span class="px-3 sm:px-4 py-2 sm:py-2.5 rounded-full text-xs sm:text-sm font-bold shadow-lg border-2 border-white/50
                        {% if order.status == 'completed' %}bg-gradient-to-r from-green-400 to-emerald-500 text-white
                        {% elif order.status == 'processing' %}bg-gradient-to-r from-blue-400 to-indigo-500 text-white
                        {% elif order.status == 'cancelled' %}bg-gradient-to-r from-red-400 to-pink-500 text-white
                        {% else %}bg-gradient-to-r from-yellow-400 to-orange-400 text-white{% endif %}">
                        {% if order.status == 'pending' %}‚è≥ –û—á—ñ–∫—É—î
                        {% elif order.status == 'processing' %}‚öôÔ∏è –û–±—Ä–æ–±–ª—è—î—Ç—å—Å—è
                        {% elif order.status == 'completed' %}‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                        {% elif order.status == 'cancelled' %}‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ
                        {% else %}{{ order.status }}{% endif %}
                    </span>
                </div>
                
                <!-- –¢–æ–≤–∞—Ä–∏ –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ -->
                <div class="bg-gradient-to-r from-pink-100/50 via-purple-100/50 to-indigo-100/50 rounded-xl sm:rounded-2xl p-4 sm:p-5 border-2 border-purple-200">
                    <h3 class="font-bold text-purple-900 mb-3 sm:mb-4 text-base sm:text-lg flex items-center gap-2">
                        <span class="text-xl sm:text-2xl">üõçÔ∏è</span>
                        <span>–¢–æ–≤–∞—Ä–∏:</span>
                    </h3>
                    <ul class="space-y-2 sm:space-y-3">
                        {% for item in order.items %}
                            <li class="bg-white/80 rounded-lg sm:rounded-xl p-3 sm:p-4 border-2 border-purple-100 hover:border-pink-300 transition-colors">
                                <div class="flex items-center justify-between gap-2">
                                    <span class="text-sm sm:text-base font-medium text-purple-900 flex-1">
                                        <span class="text-lg sm:text-xl mr-2">üéÅ</span>
                                        {{ item.product.name }}
                                    </span>
                                    <span class="bg-gradient-to-r from-pink-300 to-purple-300 text-purple-900 px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow-md border-2 border-white/50 whitespace-nowrap">
                                        x{{ item.quantity }}
                                    </span>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ –¥–ª—è pending) -->
                {% if order.status == 'pending' %}
                    <div class="mt-4 sm:mt-5 pt-4 sm:pt-5 border-t-2 border-purple-200">
                        <form method="POST" action="{{ url_for('main.cancel_order', order_id=order.id) }}" class="cancel-order-form" data-order-id="{{ order.id }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="w-full sm:w-auto bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-base shadow-lg hover:shadow-xl transition-all">
                                ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 p-6 sm:p-8 md:p-10 rounded-xl sm:rounded-2xl shadow-xl border-2 sm:border-4 border-yellow-400 text-center mx-2 sm:mx-0">
        <div class="text-6xl sm:text-8xl mb-4">üì¶</div>
        <p class="text-purple-900 text-xl sm:text-2xl font-bold mb-3 sm:mb-4">–£ –≤–∞—Å –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å! üòî</p>
        <p class="text-purple-700 text-base sm:text-lg mb-5 sm:mb-6">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –π–æ–≥–æ —Ç—É—Ç! üéÅ</p>
        <a href="{{ url_for('main.index') }}" class="inline-block bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-500 hover:from-yellow-300 hover:via-pink-400 hover:to-purple-400 text-white px-6 sm:px-8 py-3 sm:py-4 rounded-xl shadow-lg hover:shadow-xl transition-all font-bold text-base sm:text-lg bounce-hover">
            <span class="flex items-center justify-center gap-2">
                <span>üè†</span>
                <span>–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</span>
                <span>‚ú®</span>
            </span>
        </a>
    </div>
{% endif %}

<script>
    // –û–±—Ä–æ–±–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    document.addEventListener('DOMContentLoaded', function() {
        const cancelForms = document.querySelectorAll('.cancel-order-form');
        
        cancelForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const form = this;
                const orderId = form.getAttribute('data-order-id');
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
                if (typeof showConfirmModal === 'function') {
                    showConfirmModal('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?', function() {
                        form.submit();
                    });
                } else {
                    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?')) {
                        form.submit();
                    }
                }
            });
        });
    });
</script>
{% endblock %}

